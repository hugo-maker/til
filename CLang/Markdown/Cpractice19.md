# 19章 配列を自由自在に作る

## 配列の欠点

- プログラム中に要素数を変更できない
- 要素数が足りなくなったり、メモリを無駄遣いしてしまったりする⇔ 動的配列: プログラム中で要素数を変更でき、メモリを効率よく使える

## メモリの確保

### malloc関数

- malloc関数 自由に配列を作る
- ポインタ変数 = malloc(必要なメモリのバイトサイズ)
- 任意の要素数の配列を確保するには、sizeof演算子を使用する(malloc関数で確保できるのはバイト単位のサイズのため)
- メモリ確保に失敗するとNULLが返される
- malloc関数の戻り値は要確認
- 便利だが、うまく扱うのは難しい→ できるだけ普通の配列を使い、どうしても必要な場面でのみ使用を推奨

### ヒープと動的配列

- malloc関数で確保したメモリ: **ヒープ**と呼ぶ
- ヒープに確保された配列: **動的配列**と呼ぶ
- ヒープ: 長期的に使用される大きなサイズのメモリを格納する領域
- 動的配列: malloc関数などを使用して、プログラムの実行中に用意された任意のサイズの配列

### メモリの解放

- malloc関数によって確保されたメモリは、プログラム終了まで残る
- 不要になったメモリは開放してやる必要がある
- free関数: 無駄なメモリを解放する
- free(ポインタ変数);
- malloc関数を使ったら、必ずfree関数も呼び出す

### 動的配列の要素数を拡大する

- realloc関数: 動的配列の要素数を変更する 
- 新しいポインタ変数 = realloc(以前のポインタ変数,必要なメモリのバイトサイズ);
- フラグメンテーション: realloc関数を何度も呼び出すことで、メモリが散らかること。

### フラグメンテーションを予防するには

realloc関数の呼び出し回数を抑える努力をする
- malloc関数で大きめに確保しておく
- realloc関数を呼び出す際も、一回で大きめに確保する
